From b9e8b58a2214fe283ac874233c254bf4f1c1301d Mon Sep 17 00:00:00 2001
From: Jon TURNEY <jon.turney@dronecode.org.uk>
Date: Wed, 25 Jun 2014 14:17:42 +0100
Subject: [PATCH 17/17] For testing purposes, only use Windows-DRI if
 explicitly requested via an env var

Signed-off-by: Jon TURNEY <jon.turney@dronecode.org.uk>
---
 src/glx/glxext.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/glx/glxext.c b/src/glx/glxext.c
index 531b96a..86319f5 100644
--- a/src/glx/glxext.c
+++ b/src/glx/glxext.c
@@ -831,6 +831,9 @@ __glXInitialize(Display * dpy)
    struct glx_display *dpyPriv, *d;
 #if defined(GLX_DIRECT_RENDERING) && !defined(GLX_USE_APPLEGL)
    Bool glx_direct, glx_accel;
+#ifdef GLX_USE_WINDOWSGL
+   Bool glx_wgl;
+#endif
 #endif
    int i;
 
@@ -914,7 +917,8 @@ __glXInitialize(Display * dpy)
 #endif
 
 #ifdef GLX_USE_WINDOWSGL
-   if (glx_direct && glx_accel)
+   glx_wgl = !(getenv("LIBGL_USE_WGL") == NULL);
+   if (glx_direct && glx_accel && glx_wgl)
       dpyPriv->windowsdriDisplay = driwindowsCreateDisplay(dpy);
 #endif
 
-- 
2.1.0

