--- origsrc/Mesa-7.0.3/Makefile	2008-04-04 20:04:33.000000000 -0500
+++ src/Mesa-7.0.3/Makefile	2008-04-14 09:12:27.187500000 -0500
@@ -70,6 +70,7 @@
 bluegene-osmesa \
 bluegene-xlc-osmesa \
 catamount-osmesa-pgi \
+cygwin \
 darwin \
 darwin-fat-32bit \
 darwin-fat-all \
--- origsrc/Mesa-7.0.3/bin/minstall	2007-06-21 17:10:53.000000000 -0500
+++ src/Mesa-7.0.3/bin/minstall	2008-04-14 09:12:39.187500000 -0500
@@ -8,7 +8,7 @@
 
 
 # If these commands aren't portable, we'll need some "if (arch)" type stuff
-SYMLINK="ln -s"
+SYMLINK="cp -L"
 MKDIR="mkdir -p"
 RM="rm -f"
 
--- origsrc/Mesa-7.0.3/bin/mklib	2008-02-19 09:30:18.000000000 -0600
+++ src/Mesa-7.0.3/bin/mklib	2008-04-14 09:12:39.187500000 -0500
@@ -812,11 +812,11 @@
             # finish up
             FINAL_LIBS=${LIBNAME}.a
         else
-	    OPTS="-shared -Wl,-export-all -Wl,--out-implib=${LIBNAME}-${MAJOR}.dll.a"
+	    OPTS="-shared -Wl,--enable-auto-image-base -Wl,-export-all -Wl,--out-implib=${LIBNAME}.dll.a"
             if [ "${ALTOPTS}" ] ; then
                 OPTS=${ALTOPTS}
             fi
-            echo "mklib: Making" $ARCH "shared library: " ${LIBNAME}-${MAJOR}.dll
+            echo "mklib: Making" $ARCH "shared library: " ${CYGNAME}-${MAJOR}.dll
 
             if [ $CPLUSPLUS = 1 ] ; then
                 LINK="g++"
@@ -825,16 +825,14 @@
             fi
 
             # rm any old libs
-            rm -f ${LIBNAME}-${MAJOR}.dll
+            rm -f ${CYGNAME}-${MAJOR}.dll
             rm -f ${LIBNAME}.dll.a
             rm -f ${LIBNAME}.a
 
             # make lib
             ${LINK} ${OPTS} ${LDFLAGS} -o ${CYGNAME}-${MAJOR}.dll ${OBJECTS} ${DEPS}
-            # make usual symlinks
-            ln -s ${LIBNAME}-${MAJOR}.dll.a ${LIBNAME}.dll.a
             # finish up
-            FINAL_LIBS="${LIBNAME}-${MAJOR}.dll.a ${LIBNAME}.dll.a"
+            FINAL_LIBS="${LIBNAME}.dll.a"
 	    # special case for installing in bin
             FINAL_BINS="${CYGNAME}-${MAJOR}.dll"
         fi
--- origsrc/Mesa-7.0.3/configs/cygwin	1969-12-31 18:00:00.000000000 -0600
+++ src/Mesa-7.0.3/configs/cygwin	2008-04-14 09:12:39.203125000 -0500
@@ -0,0 +1,38 @@
+# Configuration for Cygwin
+
+include $(TOP)/configs/default
+
+CONFIG_NAME = cygwin
+
+# Compiler and flags
+CC = gcc
+CXX = g++
+
+WARN_FLAGS = -Wall
+OPT_FLAGS  = -O3
+PIC_FLAGS  = 
+
+# Library names (actual file names)
+GL_LIB_NAME = cyg$(GL_LIB)-1.dll
+GLU_LIB_NAME = cyg$(GLU_LIB)-1.dll
+GLUT_LIB_NAME = cyg$(GLUT_LIB)-3.dll
+GLW_LIB_NAME = cyg$(GLW_LIB)-1.dll
+OSMESA_LIB_NAME = cyg$(OSMESA_LIB)-6.dll
+
+DEFINES = -D_POSIX_SOURCE -D_POSIX_C_SOURCE=199309L -D_SVID_SOURCE \
+	-D_BSD_SOURCE -DUSE_XSHM
+
+CFLAGS   = $(WARN_FLAGS) $(OPT_FLAGS) $(PIC_FLAGS) $(ARCH_FLAGS) $(DEFINES) \
+	$(ASM_FLAGS) $(X11_INCLUDES) -ffast-math 
+
+CXXFLAGS = $(WARN_FLAGS) $(OPT_FLAGS) $(PIC_FLAGS) $(ARCH_FLAGS) $(DEFINES) \
+	$(X11_INCLUDES) 
+
+# ASM_FLAGS = -DUSE_X86_ASM -DUSE_MMX_ASM
+
+# ASM_SOURCES = $(X86_SOURCES) $(X86_API)
+
+GL_LIB_DEPS = -lXext -lX11
+GLUT_LIB_DEPS = -L$(LIB_DIR) -l$(GLU_LIB) -l$(GL_LIB) -lX11
+GLW_LIB_DEPS = -L$(LIB_DIR) -l$(GL_LIB) -lXt -lX11
+APP_LIB_DEPS = -L$(LIB_DIR) -l$(GLUT_LIB) -l$(GLU_LIB) -l$(GL_LIB) -lX11
--- origsrc/Mesa-7.0.3/src/mesa/x86/assyntax.h	2007-06-21 17:10:55.000000000 -0500
+++ src/Mesa-7.0.3/src/mesa/x86/assyntax.h	2008-04-14 09:12:39.218750000 -0500
@@ -255,7 +255,7 @@
 #endif /* ACK_ASSEMBLER */
 
 
-#if defined(__QNX__) || defined(Lynx) || (defined(SYSV) || defined(SVR4)) && !defined(ACK_ASSEMBLER) || defined(__ELF__) || defined(__GNU__) || defined(__GNUC__) && !defined(__DJGPP__) && !defined(__MINGW32__)
+#if defined(__QNX__) || defined(Lynx) || (defined(SYSV) || defined(SVR4)) && !defined(ACK_ASSEMBLER) || defined(__ELF__) || defined(__GNU__) || defined(__GNUC__) && !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__)
 #define GLNAME(a)	a
 #else
 #define GLNAME(a)	CONCAT(_,a)
@@ -1734,9 +1734,9 @@
  * If we build with gcc's -fvisibility=hidden flag, we'll need to change
  * the symbol visibility mode to 'default'.
  */
-#if defined(GNU_ASSEMBLER) && !defined(__DJGPP__) && !defined(__MINGW32__)
+#if defined(GNU_ASSEMBLER) && !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__)
 #  define HIDDEN(x) .hidden x
-#elif defined(__GNUC__) && (__GNUC__ * 100 + __GNUC_MINOR__) >= 303 && !defined(__DJGPP__) && !defined(__MINGW32__)
+#elif defined(__GNUC__) && (__GNUC__ * 100 + __GNUC_MINOR__) >= 303 && !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__)
 #  pragma GCC visibility push(default)
 #  define HIDDEN(x) .hidden x
 #else
--- origsrc/Mesa-7.0.3/src/mesa/x86/glapi_x86.S	2008-02-19 09:42:52.000000000 -0600
+++ src/Mesa-7.0.3/src/mesa/x86/glapi_x86.S	2008-04-14 09:12:39.234375000 -0500
@@ -46,7 +46,7 @@
 
 #define GL_OFFSET(x) CODEPTR(REGOFF(4 * x, EAX))
 
-#if defined(GNU_ASSEMBLER) && !defined(__DJGPP__) && !defined(__MINGW32__)
+#if defined(GNU_ASSEMBLER) && !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__)
 #define GLOBL_FN(x) GLOBL x ; .type x, function
 #else
 #define GLOBL_FN(x) GLOBL x
@@ -81,7 +81,7 @@
 	TEST_L(EAX, EAX) ;				\
 	JE(1f) ;					\
 	JMP(GL_OFFSET(off)) ;				\
-1:	CALL(_x86_get_dispatch) ;			\
+1:	CALL(GLNAME(_x86_get_dispatch)) ;			\
 	JMP(GL_OFFSET(off))
 #elif defined(THREADS)
 #  define GL_STUB(fn,off,fn_alt)			\
--- origsrc/Mesa-7.0.3/src/mesa/x86/read_rgba_span_x86.S	2007-11-09 09:52:35.000000000 -0600
+++ src/Mesa-7.0.3/src/mesa/x86/read_rgba_span_x86.S	2008-04-14 09:12:39.234375000 -0500
@@ -31,7 +31,7 @@
  */
 
 	.file	"read_rgba_span_x86.S"
-#if !defined(__DJGPP__) && !defined(__MINGW32__) /* this one cries for assyntax.h */
+#if !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__) /* this one cries for assyntax.h */
 /* Kevin F. Quinn 2nd July 2006
  * Replaced data segment constants with text-segment instructions.
  */
@@ -669,7 +669,7 @@
 	emms
 #endif
 	ret
-#endif /* !defined(__DJGPP__) && !defined(__MINGW32__) */
+#endif /* !defined(__DJGPP__) && !defined(__MINGW32__) && !defined(__CYGWIN__) */
 	
 #if defined (__ELF__) && defined (__linux__)
 	.section .note.GNU-stack,"",%progbits
